# Model training

This is a module for training the FRED-T5-1.7B model.

## How to run

1. Open the Terminal or Command Prompt in the root directory of this repository.

    ```bash
    cd path/to/work-definition-modeling
    ```

2. Make sure you've installed the requirements.

    You can do it by running

    ```bash
    pip3 install -r requirements.txt
    pip3 install -r requirements_train.txt
    ```

    You also have to install the `torch` library that will be optimal for your machine.
    For example, if you have a CUDA enabled GPU on Windows, you would probably want to run this:

    ```bash
    pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
    ```

    Check the [official PyTorch website](https://pytorch.org/get-started/locally/)
    for more information.

3. Make sure you have the dataset.

    It is a `.jsonl` file called `definitions.jsonl`
    generated by the `wiktionary_parser` module. The file should be located in the `data` folder.
    If not, follow the instructions in [wiktionary_parser](../wiktionary_parser/README.md)
    or download the dataset from
    [here](https://drive.google.com/file/d/18_DHa_t0Fngqsj8fl2cym4-sZ5pDrlyf/view?usp=sharing).

4. Configure the training parameters in `train_config.json`.

    They mostly follow the parameters in the Seq2Seq
    [Trainer](https://huggingface.co/transformers/main_classes/trainer.html#trainingarguments)
    class of the `transformers` library.

    The exception are `debug`.
    If set to `True`, the training will run on a small subset of the data.
    Also, `test_dataset_output_path` is the path of the future test split of the dataset.

5. Run `train.py` with the following command to start training.

    ```bash
    python3 -m model_training.train
    ```

    The checkpoints will be saved in the `models` folder.

## Plots

The plots are generated automatically based on log history from trainer state
when each checkpoint and are saved under `path/to/checkpoint/graphs` directory.

But you can also regenerate them manually by running `plot.py` with the following command.

```bash
python3 -m model_training.plot path/to/checkpoint
```

You can also specify the metrics you want to plot by passing them as arguments.

```bash
python3 -m model_training.plot path/to/checkpoint --metrics eval_rougeL
```
